# Railway Deployment Guide for Food Truck App

## Overview
This guide will help you deploy your food truck app on Railway. The app includes:
- **Frontend**: React + Vite
- **Backend**: Express.js + Node.js
- **Database**: PostgreSQL (Railway managed)
- **Real-time**: Socket.IO
- **Payments**: Stripe integration
- **File uploads**: Image handling

## Prerequisites

1. **Railway Account**: Sign up at [railway.app](https://railway.app)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **Stripe Account**: For payment processing
4. **Domain** (optional): For custom domain

## Step-by-Step Deployment

### 1. Prepare Your Repository

Make sure your project structure looks like this:
```
food-truck-app/
â”œâ”€â”€ src/                 # React frontend
â”œâ”€â”€ server/             # Express backend
â”œâ”€â”€ public/             # Static assets
â”œâ”€â”€ package.json        # Dependencies and scripts
â”œâ”€â”€ railway.toml        # Railway configuration
â”œâ”€â”€ vite.config.js      # Vite configuration
â””â”€â”€ README.md
```

### 2. Create Railway Project

1. Go to [railway.app](https://railway.app) and sign in
2. Click "New Project"
3. Choose "Deploy from GitHub repo"
4. Select your food truck app repository

### 3. Add PostgreSQL Database

1. In your Railway project dashboard, click "New Service"
2. Select "Database" â†’ "PostgreSQL"
3. Railway will automatically create a PostgreSQL instance
4. The database URL will be available as `DATABASE_URL` environment variable

### 4. Configure Environment Variables

In your Railway project, go to "Variables" and add:

```env
NODE_ENV=production
JWT_SECRET=your_jwt_secret_here
STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_publishable_key
STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key
DATABASE_URL=${{Postgres.DATABASE_URL}}
FRONTEND_URL=https://your-app-name.up.railway.app
```

**Important**: Replace the values with your actual credentials.

### 5. Update Railway Configuration

Your `railway.toml` should be configured as follows:

```toml
[build]
builder = "nixpacks"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
startCommand = "npm run start:railway"

[services.variables]
NODE_ENV = "production"
```

### 6. Build and Start Scripts

Your `package.json` should have these scripts:

```json
{
  "scripts": {
    "dev": "concurrently \"npm run server\" \"vite\"",
    "server": "node server/index.js",
    "build": "vite build",
    "start": "node server/index.js",
    "start:railway": "npm run build && node server/index.js"
  }
}
```

### 7. Deploy

1. Push your changes to GitHub
2. Railway will automatically detect the changes and start building
3. Monitor the build process in the Railway dashboard
4. Once deployed, you'll get a URL like `https://your-app-name.up.railway.app`

## Post-Deployment Configuration

### 1. Update Stripe Webhook URLs

In your Stripe dashboard, update webhook endpoints to:
```
https://your-app-name.up.railway.app/api/stripe/webhook
```

### 2. Test Payment Flow

1. Visit your deployed app
2. Try placing a test order
3. Verify payment processing works
4. Check order management in admin dashboard

### 3. Configure Custom Domain (Optional)

1. In Railway dashboard, go to "Settings" â†’ "Domains"
2. Add your custom domain
3. Update DNS records as instructed
4. Update `FRONTEND_URL` environment variable

## Environment Variables Reference

| Variable | Description | Example |
|----------|-------------|---------|
| `NODE_ENV` | Environment mode | `production` |
| `DATABASE_URL` | PostgreSQL connection | Auto-generated by Railway |
| `JWT_SECRET` | JWT signing secret | Random 64-character string |
| `STRIPE_PUBLISHABLE_KEY` | Stripe public key | `pk_live_...` |
| `STRIPE_SECRET_KEY` | Stripe secret key | `sk_live_...` |
| `FRONTEND_URL` | App domain | `https://your-app.up.railway.app` |

## Troubleshooting

### Build Failures

1. **Check build logs** in Railway dashboard
2. **Verify dependencies** in package.json
3. **Check Node.js version** compatibility

### Database Connection Issues

1. **Verify DATABASE_URL** is set correctly
2. **Check PostgreSQL service** is running
3. **Review database initialization** in server code

### Payment Issues

1. **Verify Stripe keys** are correct
2. **Check webhook configuration**
3. **Test with Stripe test mode** first

### CORS Issues

1. **Update CORS origins** in server/index.js
2. **Verify FRONTEND_URL** matches your domain
3. **Check browser console** for CORS errors

## Production Checklist

- [ ] Environment variables configured
- [ ] Database connected and initialized
- [ ] Stripe keys updated (live mode)
- [ ] Webhook URLs updated
- [ ] Custom domain configured (if applicable)
- [ ] SSL certificate active
- [ ] Test complete order flow
- [ ] Admin dashboard accessible
- [ ] Real-time updates working

## Support

If you encounter issues:

1. Check Railway build and runtime logs
2. Review this guide for missed steps
3. Test locally first with production environment variables
4. Contact Railway support if needed

## Security Notes

- Never commit sensitive environment variables to git
- Use Railway's environment variable management
- Regularly rotate JWT secrets and API keys
- Monitor for suspicious activity in your app logs

Your food truck app should now be successfully deployed on Railway! ðŸš€ 